<!DOCTYPE html>
<html lang="en">
  <head>
    <title>EasyEDA 3d export test</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <style>
      b {
        color: lightgreen;
      }

      html {
        margin: 0;
        padding: 0;
      }

      body {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>
    <script type="module">
      import * as THREE from "https://cdnjs.cloudflare.com/ajax/libs/three.js/r123/three.module.js";
      import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.123.0/examples/jsm/controls/OrbitControls.js";
      import { OBJLoader } from "https://cdn.jsdelivr.net/npm/three@0.123.0/examples/jsm/loaders/OBJLoader.js";
      import DataStore from "./DataStore.js";
      import Pcb3D from "./Pcb3D.js";

      const BOARD_THICKNESS = 3;

      const SCREEN_WIDTH = window.innerWidth;
      const SCREEN_HEIGHT = window.innerHeight;

      let renderer, scene, camera;

      // Load 3d-data example file
      // The following command needs to be started :
      //      npx http-server /home/alabate/dev/easyeda-3d-export
      // And the page accessed from http://127.0.0.1:8081/test.html
      const request = new Request("./dev-exemple-src.json");
      fetch(request)
        .then((response) => response.json())
        .then((data) => {
          const datastore = new DataStore(data);

          // Tree js Init
          init(datastore);
          animate();
        });

      function init(datastore) {
        // Scene
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x808080);

        // Cameras
        camera = new THREE.PerspectiveCamera(
          75,
          SCREEN_WIDTH / SCREEN_HEIGHT,
          0.1,
          1000
        );
        scene.add(camera);

        // Lights
        scene.add(new THREE.AmbientLight(0xffffff, 0.1));
        camera.add(new THREE.PointLight(0xffffff, 1));

        // Renderer
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
        document.body.appendChild(renderer.domElement);

        // Add PCB to scene
        const pcb3d = new Pcb3D(datastore);
        pcb3d.addToScene(scene);

        // Controls
        const boardCentroid = pcb3d.getPcbBoardCentroid();
        const controls = new OrbitControls(camera, renderer.domElement);
        camera.position.set(boardCentroid.getX(), boardCentroid.getY(), 100);
        controls.target.set(boardCentroid.getX(), boardCentroid.getY(), 0);
        controls.update();
      }

      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
